<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />    
    <title>Plantlore Server</title>
  </head>
  <body>
	<h1>Plantlore Server</h1>

	<p>
	Aby se mohli k vaší databázi připojovat i jiní uživatelé z počítačů v síti, 
	musí být spuštěn Plantlore Server. 
	Server zprostředkovává připojení vzdáleným klientům a dohlíží na dodržování
	předepsaného počtu klientů. Standardně se z jednoho počítače (z jedné IP adresy)
	smí přihlásit nejvýše tři klienti a maximální celkový počet současně připojených
	uživatelů je omezen na 32.
	</p>

        <!--
	<h2>Obsah</h2>

	<p>
	<ol>
		<li>Vytvoření a spuštění nového serveru</li>
		<li>Připojení k existujícímu serveru za účelem administrace</li>
	</ol>
	</p>
        -->




	<h2><a name="connection">1. Vytvoření a spuštění nového serveru</a></h2>

	<p>
	Nastavení serveru lze provést na záložce "Spustit nový server".
	</p>

	<p>
	<img src="picture/ServerCreate.png" alt="Spuštění serveru.">
	</p>


	<p>
	Server lze spustit pouze na lokálním počítači. Jako správce serveru máte možnost nastavit následující parametry:
	</p>

	<p>
	<table>
		<tr>
			<th colspan="2">
				Nastavení serveru
			</th>
		</tr>

		<tr>
			<th>
				Parametr
			</th>
			<th>
				Význam
			</th>
		</tr>

		<tr>
			<td>
				Heslo
			</td>
			<td>
				Po spuštění je možné server administrovat 
				i ze vzdáleného počítače.
				Aby k němu neměly přístup nepovolané osoby, 
				je možné nastavit heslo, kterým bude server chráněn.
				Kdokoli se bude chtít k serveru připojit za účelem
				administrace, bude se muset tímto heslem prokázat.
			</td>
		</tr>

		<tr>
			<td>
				Port
			</td>
			<td>
				Port určuje, kde bude server naslouchat, aby se k němu mohli 
				připojovat vzdálení klienti. 

				Port je číslo v rozsahu 0 až 65.535, přičemž je běžné, 
				že servery využívají porty vyšší než 1.024, neboť nižší porty
				bývají rezervovány pro známé služby (FTP, HTTP, Telnet, ...).

				Porty nelze sdílet - ujistěte se, že na zvolený port již
				některá jiná aplikace nepoužívá.

				Standardní port je 1099.
			</td>
		</tr>

		<tr>
			<th colspan="2">
				Nastavení databázového stroje
			</th>
		</tr>

		<tr>
			<th>
				Parametr
			</th>
			<th>
				Význam
			</th>
		</tr>

		<tr>
			<td>
				Typ DB
			</td>
			<td>
				Existuje několik databázových strojů (database engine), které umožňují snadnou
				práci s databázemi, tabulkami, uživateli, dotazy a daty.
				Každý databázový stroj může obsahovat několik různě pojmenovaných databází
				s různou strukturou a s různým obsahem. Mezi nejznámější databázové stroje
				patří Oracle, MSSQL, MySQL, Postgre a Firebird.
				Plantlore podporuje práci s různými databázovými stroji,
				ale je nutné přesně specifikovat, o který se jedná, 
				aby s ním mohl bezchybně komunikovat. Plantlore je standardně dodáván
				s Postgre. Aktuálně podporované DB stroje jsou vypsány v rozbalovací
				nabídce, ale je možné specifikovat i jiný.
			</td>
		</tr>

		<tr>
			<td>
				Port DB
			</td>
			<td>
				Databázové stroje umožňují připojení pouze přes tzv. port. Každý databázový
				stroj má tento port jiný a navíc jej lze snadno změnit. Aby Plantlore Server věděl,
				kde má databázový stroj kontaktovat, musí znát port, na kterém stroj naslouchá.
				Port je číslo v rozsahu 0 až 65.535, přičemž je běžné, že databázové stroje
				využívají porty v rozsahu 1.024 až 10.000. Například standardní port databázového
				stroje Postgre je 5432.
			</td>
		</tr>

		<tr>
			<td>
				Parametr
			</td>
			<td>
				Databázový stroj může být potřeba ještě nakonfigurovat nějakým specifickým
				způsobem. Některé stroje kupříkladu vyžadují explicitní nastavení kódování
				znaků. Tenot parametr slouží
				pro správné nastavení dodatečných parametrů připojení k databázovému stroji.
				Připojení k Postgre žádný parametr nevyžaduje, ale např. pro správné zobrazení
				diakritiky od Firebird je potřeba kódování nastavit.
				<br/>
				<i>Odborné: parametr je hodnota předávaná v připojovacím JDBC řetězci za :?:</i>
			</td>
		</tr>

	</table>
	</p>



	<h2><a name="info">2. Připojení k běžícímu serveru</a></h2>


	<p>
	Víte-li, že někde běží server, který jste spustili, můžete jej vzdáleně  
	administrovat. Nejprve se k tomuto serveru
	musíte připojit pomocí záložky "Připojení k běžícímu serveru".
	</p>

	<p>
	<img src="picture/ServerConnect.png" alt="Spuštění serveru.">
	</p>


	<p>
	Pro připojení je nutno specifikovat následující parametry
	</p>

	<p>
	<table>
		<tr>
			<th>
				Parametr
			</th>
			<th>
				Význam
			</th>
		</tr>

		<tr>
			<td>
				Host
			</td>
			<td>
				Tento parametr identifikuje počítač, kde server běží, a to buď podle
				jeho jména nebo IP adresy. Každý počítač připojený k síti musí mít
				svou vlastní unikátní IP adresu, podle níž je rozpoznán. IP adresa je 
				nejčastěji čtveřice čísel oddělená tečkami, např. "192.168.0.247".
				Některé počítače mají kromě IP adresy přidělena i jména, např. 
				"data.domacisit.cz". 
			</td>
		</tr>

		<tr>
			<td>
				Port
			</td>
			<td>
				Port určuje, kde vzdálený server naslouchá.

				Port je číslo v rozsahu 0 až 65.535, přičemž je běžné, 
				že servery využívají porty vyšší než 1.024, neboť nižší porty
				bývají rezervovány pro známé služby (FTP, HTTP, Telnet, ...).

				Standardní port je 1099.
			</td>
		</tr>

		<tr>
			<td>
				Heslo
			</td>
			<td>
				Heslo chránící přístup k serveru pro účely administrace.
			</td>
		</tr>
	</table>
	</p>




	<h2><a name="manager">3. Administrace serveru</a></h2>

	<p>
	Administrace slouží především k získání informací o aktuálně připojených uživatelích
	a vypínání serveru. Administrátor by měl vyčkat, až se všichni uživatelé
	odpojí, než vypne server. Plantlore Server neimplementuje žádný způsob 
	upozorňování klientů, má-li být server vypnut.
	</p>

	<p>
	<img src="picture/ServerManager.png" alt="Administrace serveru.">
	</p>

	<p>
	Po připojení/vytvoření k serveru je k dispozici seznam aktuálně připojených uživatelů.
	Dále je možné provést následující operace:
	<ul>
		<li><b>Obnovit</b>.
		Aktualizuje seznam s uživateli přihlášenými k tomuto serveru.
		</li>
		<li><b>Vyhodit</b>.
		Odpojí označeného klienta od serveru (tzv. kick).
		Odpojení je násilné a přeruší všechny operace, které klient provádí.
		Neslouží k zabránění opětovného připojení k serveru, protože blokování IP
		adresy může odstavit i jiné klienty. 
		<br/>
		Význam spočívá v tom, že poskytuje prostředek, jak odpojit neukázněné
		klienty, kteří díky své nedbalosti používají více připojení, než je třeba,
		a mohou tím blokovat jiné uživatele, kteří mají navenek stejnou IP adresu.
		<br/>
		Pokud chcete klientovi zabránit v opětovném připojení, zakažte jeho uživatelský
		účet ve <a href="./import.html">Správě uživatelů</a>.
		</li>
		<li><b>Zastavit</b>.
		Ukončí činnost serveru, všichni uživatelé přihlášení k tomuto serveru budou odpojeni
		bez ohledu na to, zda mají spuštěny nějaké operace.
		</li>
		<li><b>Skrýt</b>.
		Skryje okno, ale server nechá spuštěný. Pro pozdější administraci se k Serveru musíte
		znovu přihlásit, jak je popsáno v části 2.
		</li>
	</ul>
	</p>  
        
        
	<h2>4. Administrace serveru z příkazové řádky</h2>


	<p>
	Server lze ovládat přímo z příkazové řádky. V případě, že jsou detekovány parametry nebo přepínače
	pro takové ovládání, nespouští se grafický režim. Ovládání pomocí GUI i příkazové řádky je ekvivalentní.
	Navíc je možné z příkazové řádky "přebít" uložené nastavení serveru (tj. spustit server s uloženým
	nastavením, pouze na jiném portu apod.)
	</p>

	<p>
	Parametry lze zadávat třemi způsoby: bez pomlčky, s jednou pomlčkou nebo se dvěma pomlčkami.
	Zkrácené verze parametrů (tzv. přepínače) nejsou k dispozici. Parametry nejsou case-sensitive,
	nezáleží na velikosti jejich písmen. Neznámé parametry jsou ignorovány.
	</p>

	<p>
	Mezi příkazy patří následující parametry:
	<table>
	<tr>
	<th>Parametr</th><th>Význam</th>
	</tr>

	<tr>
	<td><b>terminate</b></td><td>vypnutí daného serveru (okamžitě), akceptuje parametry: port, host, password</td
	</tr>

	<tr>
	<td><b>who</b></td><td>vypsání aktuálně připojených klientů na daném serveru, akceptuje parametry: port, host, password</td>
	</tr>

	<tr>
	<td><b>nogui</b></td><td>spuštění nového serveru (aniž by bylo zobrazeno GUI),
		akceptuje parametry: port, timeout, connectionsTotal, connectionsPerIP, databasePort, databaseEngine, databaseParameter, password</td>
	</tr>
	</table>
	</p>

	<p>
	Přepínače bez parametrů jsou tyto:
	<table>
	<tr>
	<th>Parametr</th><th>Význam</th>
	</tr>

	<tr>
	<td><b>silent</b></td><td>na standardní výstup nevypisovat vůbec žádné informace o průběhu akcí</td>
	</tr>

	</table>
	</p>

	<p>
	Parametry dodávající další význam:
	<table>
	<tr>
	<th>Parametr</th><th>Význam</th><th>Default</th>
	</tr>

	<tr>
	<td><b>port</b></td><td>port, na kterém je spuštěn nebo má být spuštěn server</td><td>1099</td>
	</tr>
	<tr>
	<td><b>timeout</b></td><td>za jak dlouho budou nečinní uživatelé odhlášeni automaticky ze serveru (v minutách)</td><td>3</td>
	</tr>
	<tr>
	<td><b>connectionsTotal</b></td><td>celkový maximální počet klientů na serveru</td><td>32</td>
	</tr>
	<tr>
	<td><b>connectionsPerIP</b></td><td>maximální počet klientů přihlášených ze stejné IP adresy</td><td>2</td>
	</tr>
	<tr>
	<td><b>databasePort</b></td><td>port, na kterém běží databázový stroj</td><td>5432</td>
	</tr>
	<tr>
	<td><b>databaseEngine</b></td><td>typ databáze</td><td>postgresql</td>
	</tr>
	<tr>
	<td><b>databaseParameter</b></td><td>speciální konfigurační řetězec pro databázový stroj</td><td></td>
	</tr>
	<tr>
	<td><b>password</b></td><td>heslo k běžícímu serveru</td><td></td>
	</tr>
	<tr>
	<td><b>host</b></td><td>jméno nebo IP adresa počítače, kde je server spuštěn</td><td>localhost</td>
	</tr>
	</table>
	Nejsou-li některé potřebné parametry zadány, použijí se ty, co jsou uloženy v konfiguračním souboru <b>plantlore.server.xml</b>.
	Pokud nejsou v konfiguračním soubouru hodnoty uloženy, použijí se defaultní hodnoty (uvedeny v závorkách u jednotlivých parametrů).
	</p>

	<p>
	Jednoduché příklady (uváděny jsou pouze parametry):<br/>
	<ul>
	<li><pre>nogui</pre> spustí server s uloženými nastaveními (bez hesla!)</li>
	<li><pre>nogui port 2332 password wer#41xp@@-</pre> spustí server na portu 2332 chráněný heslem wer#41xp@@- </li>
	<li><pre>terminate</pre> ukončí server</li>
	<li><pre>terminate port 2332 host 192.168.0.17 password etaBruTsam</pre> ukončí server na počítači 192.168.0.17 na portu 2332 chráněný heslem etaBruTsam</li>
	<li><pre>who port 2332 password etTuBrute?</pre> vypíše seznam klientů připojených k serveru na portu 2332, autorizuje se heslem etTuBrute? </li>
	</ul>
	</p>

	<p>
	Zajímavější příklady (uváděny jsou pouze parametry) - provádějí přesně totéž, co příklady nahoře:<br/>
	<ul>
	<li><pre>start a new server with the default settings; ah, and yes: --nogui</pre></li>
	<li><pre>start a new server on port 2332 protected by password wer#41xp@@- and nogui</pre></li>
	<li><pre>terminate the server using the default settings</pre></li>
	<li><pre>terminate the server running on port 2332 on host 192.168.0.17 protected by password etaBruTsam</pre></li>
	<li><pre>tell me who is logged to the server on port 2332 protected by password etTuBrute?</pre></li>
	</ul>
	</p>

	<p>
	Není nutné parametry uvádět s pomlčkami. Musí být ovšem dodrženo pravidlo, že parametr a jeho hodnota musí následovat bezprostředně po sobě,
	jinak bude parametr ignorován. "Zajímavější" příklady jsou pouze hříčka využívající toho, že neznámé parametry jsou ignorovány.	
	</p>


        <h2>5. Odstraňování problémů</h2>

	<p>
        Při spuštění Serveru se může stát, že Server není schopen automaticky
        rozpoznat IP adresu počítače, na kterém běží, přestože autodetekční rutina
        zkouší několik způsobů detekce.
        Typicky jsou tímto problémem postiženy počítače se dvěma
        síťovými rozhraními nebo počítače s OS Linux 
        (zde může být příčinou i špatné nastavení /etc/hosts).
	</p>
        
        <p>
        Pro správný běh RMI, technologie použité pro zprostředkování
        komunikace po síti, je zapotřebí, aby byl správně nastaven
        parametr "java.rmi.server.hostname".
        Není-li tento parametr nastaven správně, vzdálená připojení
        selžou s následující chybou:
        <pre>
        java.rmi.ConnectException: Connection refused to host: 127.0.0.1; 
        nested exception is:
           java.net.ConnectException: Connection refused: connect
        </pre>
        </p>
        
        <p>
        Odstranění této chyby vyžaduje ruční nastavení IP adresy stroje, 
        kde Server běží. To lze provést při spouštění Serveru následovně:
        <pre>
        java -Djava.rmi.server.hostname=VašeIP -jar plantlore-server.jar
        </pre>
        a pokud nepoužíváte dodaný jar archiv:
        <pre>
        java -Djava.rmi.server.hostname=VašeIP net.sf.plantlore.server.Plantlore
        </pre>
        </p>
        
  </body>
</html>
